<!DOCTYPE html>
<html class="no-js" lang="en-us" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.55.1" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Forget me not...">
    <meta name="author" content="">

    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/favicon.ico">

    <title>Forget me not... &middot; Forget me not...</title>

   	
    
        <link rel="stylesheet" href="https://henrich.github.io/blog//css/theme/simplex.css">
    

    <link rel="stylesheet" href="https://henrich.github.io/blog//css/font-awesome.min.css">

   	
   	<link rel="stylesheet" href="https://henrich.github.io/blog//css/style.css">


    
    <script src="https://henrich.github.io/blog//js/jquery.min-2.1.4.js"></script>
    <script src="https://henrich.github.io/blog//js/bootstrap.min-3.3.5.js"></script>

    
    <link href="https://henrich.github.io/blog/index.xml" rel="alternate" type="application/rss+xml" title="Forget me not..." />
</head>
<body lang="en">
    
    <div class="container">
    <div class="row">
        <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="navbar-header">
                <a class="navbar-brand" href="https://henrich.github.io/blog/">Forget me not...</a>
            </div>
            <div class="navbar-collapse collapse navbar-responsive-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://henrich.github.io/blog/">Home</a></li>
                    <li><a href="https://henrich.github.io/blog//post/">Blog</a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</div>



    <div class="container">
        
        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/04/08/%E3%82%81%E3%82%93%E3%81%A6%E3%81%AA%E3%81%AE%E3%81%8A%E3%81%97%E3%81%94%E3%81%A8/">めんてなのおしごと</a></h3>
						<small><span class="label label-primary">
							
								Mon, Apr 8, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p>パッケージング、残りは<code>ruby-strptime</code>と<code>ruby-tzinfo-data</code>か、ということで<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=926621">ruby-strptimeのITP作業</a>した。<code>ruby-tzinfo-data</code>の方はtzdataを引っ張ってこれない環境だと必要なのでは？と判断して削る方向で…あ、<a href="https://bugs.debian.org/926623">ruby-parallel-tests</a>も追加。</p>

<p>これで大体依存関係終わったかな…。</p>

<ul>
<li><a href="https://bugs.debian.org/926266">ruby-cool.io</a></li>
<li><a href="https://bugs.debian.org/926570">ruby-sigdump</a></li>
<li><a href="https://bugs.debian.org/926572">ruby-serverengine</a></li>
<li><a href="https://bugs.debian.org/926621">ruby-strptime</a></li>
<li><a href="https://bugs.debian.org/926623">ruby-parallel-tests</a></li>
</ul>

<p>ここまで来て、ようやく<code>fluentd</code>のパッケージングに再度入れる。</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/04/07/%E3%82%81%E3%82%93%E3%81%A6%E3%81%AA%E3%81%AE%E3%81%8A%E3%81%97%E3%81%94%E3%81%A8/">めんてなのおしごと</a></h3>
						<small><span class="label label-primary">
							
								Sun, Apr 7, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p>先日<code>gem2deb</code>で変換した<code>ruby-dig-rb</code>を仕上げておこうとしてdescription書く際に<a href="https://github.com/jrochkind/dig_rb">サイト</a>を見て「ん？」と気付く。</p>

<pre><code class="language-text">Ruby 2.3.0 introduced #dig on Hash, Array, and Struct. With this gem, you can have dig on ruby pre 2.3.0, or any ruby lacking dig.

If you are writing an app and want to use dig in it you should probably just upgrade to ruby 2.3.0. But if you are writing a gem and want it to work with both MRI 2.3.0 and others (including JRuby 9.0.x), this gem is for you. This gem only adds #dig methods if they aren't already defined, so it's safe to use in code that is for all rubies, if run on MRI 2.3.0 you'll still be using native #dig, otherwise dig_rb's implementation.
</code></pre>

<p>Ruby2.3で同じ機能を導入してるから、CRuby以外の実装で必要だ、という場合以外は不要だということか&hellip;。んでは無視しよう。<a href="https://github.com/fluent/fluentd/pull/2372">fluentdにはPR上げてみておいた</a>。</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/04/03/%E3%82%81%E3%82%93%E3%81%A6%E3%81%AA%E3%81%AE%E3%81%8A%E3%81%97%E3%81%94%E3%81%A8/">めんてなのおしごと</a></h3>
						<small><span class="label label-primary">
							
								Wed, Apr 3, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p><code>itamae</code>のアップデートに<code>fluentd</code>が必要そうなのでこちらをやろうとしてみる。</p>

<pre><code class="language-bash">$ gem2deb fluentd
fluentd doesn't seem to exist. Let's try to download it with 'gem fetch fluentd'
gem fetch fluentd
Fetching: fluentd-1.4.2.gem (100%)
Downloaded fluentd-1.4.2
-- Creating source tarball from fluentd-1.4.2.gem ...
tar xfm /home/henrich/src/pkg-ruby-extras/fluentd-1.4.2.gem
&quot;tar xzfm data.tar.gz&quot;
tar czf /home/henrich/src/pkg-ruby-extras/fluentd-1.4.2.tar.gz fluentd-1.4.2
-- Successfully created ./fluentd-1.4.2.tar.gz

-- Creating Debian source package from ./fluentd-1.4.2.tar.gz ...
tar xzf ruby-fluentd_1.4.2.orig.tar.gz
-- Generated Debian source tree in ruby-fluentd-1.4.2

-- Building Debian package ...
dpkg-buildpackage -us -uc
dpkg-buildpackage: info: source package ruby-fluentd
dpkg-buildpackage: info: source version 1.4.2-1
dpkg-buildpackage: info: source distribution UNRELEASED
dpkg-buildpackage: info: source changed by Hideki Yamane &lt;henrich@debian.org&gt;
dpkg-buildpackage: info: host architecture amd64
 dpkg-source --before-build .
dpkg-checkbuilddeps: error: Unmet build dependencies: ruby-cool.io (&lt;&lt; 2.0.0) ruby-cool.io (&gt;= 1.4.5) ruby-dig-rb (&gt;= 1.0.0) ruby-http-parser.rb (&lt;&lt; 0.7.0) ruby-http-parser.rb (&gt;= 0.5.1) ruby-msgpack (&lt;&lt; 2.0.0) ruby-msgpack (&gt;= 0.7.0) ruby-serverengine (&lt;&lt; 3.0.0) ruby-serverengine (&gt;= 2.0.4) ruby-sigdump (&gt;= 0.2.2) ruby-strptime (&lt;&lt; 1.0.0) ruby-strptime (&gt;= 0.2.2) ruby-tzinfo (&gt;= 1.0) ruby-tzinfo-data (&gt;= 1.0) ruby-yajl (&gt;= 1.0)
dpkg-buildpackage: warning: build dependencies/conflicts unsatisfied; aborting
</code></pre>

<p>依存関係が解決できなくてビルド失敗してる。<code>ruby-cool.io</code>パッケージが無いようなので、まずはこちらから作業。<code>gem2deb</code>でサクッと変換…と思いきや</p>

<pre><code class="language-bash">$ gem2deb cool.io
(snip)
dpkg-checkbuilddeps: error: Unmet build dependencies: ruby-rspec
dpkg-buildpackage: warning: build dependencies/conflicts unsatisfied; aborting
</code></pre>

<p>なぜにruby-rspecが無いとでる？</p>

<pre><code class="language-bash">$ apt show ruby-rspec
Package: ruby-rspec
Version: 3.8.0c0e1m0s0-1
Priority: optional
Section: ruby
</code></pre>

<p>あるよ？…もしかして、作業環境に入ってないから？いやー<code>cowbuilder</code>みたいにビルド環境で処理してよ…。とりあえず諸々作業…テストがコケたが、DNSを引きにいくものだったので無効にした。再度ビルド…</p>

<pre><code class="language-bash">   dh_dwz -O--buildsystem=ruby
dwz: debian/ruby-cool.io/usr/lib/x86_64-linux-gnu/ruby/vendor_ruby/2.5.0/cool.io_ext.so: DWARF version 0 unhandled
dwz: debian/ruby-cool.io/usr/lib/x86_64-linux-gnu/ruby/vendor_ruby/2.5.0/iobuffer_ext.so: DWARF version 0 unhandled
dwz: Too few files for multifile optimization
objcopy: 'debian/ruby-cool.io/usr/lib/debug/.dwz/x86_64-linux-gnu/ruby-cool.io.debug': No such file
dh_dwz: objcopy --compress-debug-sections debian/ruby-cool.io/usr/lib/debug/.dwz/x86_64-linux-gnu/ruby-cool.io.debug returned exit code 1
make: *** [debian/rules:6: binary] Error 2
dpkg-buildpackage: error: debian/rules binary subprocess returned exit status 2
</code></pre>

<p>どうも<code>debhelper level12</code>で出る問題なのだけど、<code>dh_dwz</code>って全く理解してないので一旦level11に落として回避…。あらかた出来たので<a href="https://salsa.debian.org/ruby-team/ruby-cool.io">リポジトリに追加</a>、<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=926266">ITPバグも登録</a>してアップロードした（この間にupstreamのバージョンが1.5.3から1.5.4に上がってギョッとした）。<code>NEW queue</code>通るのはずっと先だろうな…。</p>

<hr />

<p>次は<code>ruby-dig-rb</code>パッケージ。</p>

<pre><code class="language-bash">$ gem2deb dig-rb  
dig-rb doesn't seem to exist. Let's try to download it with 'gem fetch dig-rb'
gem fetch dig-rb
ERROR:  Could not find a valid gem 'dig-rb' (&gt;= 0) in any repository
ERROR:  Possible alternatives: dig_rb  
Failed to download .gem file
</code></pre>

<p>gemが見つからない？とおもったら「dig_rb」と<code>_</code>使ってるでやんの…指定し直し。</p>

<pre><code class="language-bash">$ gem2deb dig_rb  
dig_rb doesn't seem to exist. Let's try to download it with 'gem fetch dig_rb'
gem fetch dig_rb
Fetching: dig_rb-1.0.1.gem (100%)
Downloaded dig_rb-1.0.1
(snip)
-- Debian package successfully built!
</code></pre>

<p>素晴らしい、無事変換できた。</p>

<hr />

<p>次に無いのは<code>ruby-serverengine</code>パッケージ。</p>

<pre><code class="language-bash">pbuilder-satisfydepends-dummy : Depends: ruby-sigdump (&gt;= 0.2.2) which is a virtual package and is not provided by any available package
</code></pre>

<p><code>gem2deb sigdump</code>で対応、basecowに入れておく。</p>

<pre><code class="language-bash">$ sudo cp -arp /var/cache/pbuilder/base.cow /var/cache/pbuilder/ruby.cow
$ sudo cp ruby-sigdump_0.2.4-1_all.deb /var/cache/pbuilder/ruby.cow/tmp
$ sudo cowbuilder --login --basepath /var/cache/pbuilder/ruby.cow --save-after-exec
</code></pre>

<pre><code class="language-bash"># apt install /tmp/ruby-sigdump_0.2.4-1_all.deb
</code></pre>

<pre><code class="language-bash">$ sudo cowbuilder --build --basepath /var/cache/pbuilder/ruby.cow/ ruby-serverengine_2.1.0-1.dsc
</code></pre>

<p>で、パッケージバージョンでエラーになったのでこんなふうにしてみた。</p>

<pre><code class="language-diff">--- a/serverengine.gemspec
+++ b/serverengine.gemspec
@@ -21,8 +21,8 @@
   gem.add_dependency &quot;sigdump&quot;, [&quot;~&gt; 0.2.2&quot;]

   # rake v12.x doesn't work with rspec 2. rspec should be updated to 3
-  gem.add_development_dependency &quot;rake&quot;, [&quot;~&gt; 11.0&quot;]
-  gem.add_development_dependency &quot;rspec&quot;, [&quot;~&gt; 2.13.0&quot;]
+  gem.add_development_dependency &quot;rake&quot;
+  gem.add_development_dependency &quot;rspec&quot;

   gem.add_development_dependency 'rake-compiler-dock', ['~&gt; 0.5.0']
   gem.add_development_dependency 'rake-compiler', ['~&gt; 0.9.4']
</code></pre>

<p>でもやっぱりエラー。</p>

<pre><code class="language-bash">Could not find gem 'rake-compiler-dock (~&gt; 0.5.0)' in any of the gem sources listed in your Gemfile.
</code></pre>

<p>あー。ないね。</p>

<pre><code class="language-bash">$ gem2deb rake-compiler-dock
(snip)
7 tests, 21 assertions, 5 failures, 0 errors, 0 pendings, 0 omissions, 0 notifications
28.5714% passed
</code></pre>

<p>エラーログを見る。</p>

<pre><code class="language-rake">TestEnvironmentVariables:
  test_HOST_RUBY_PLATFORM:  Docker is not available.
</code></pre>

<p>これは難儀そう…とdebian/controlを眺めると「Easy to use and reliable cross compiler environment for building Windows and Linux binary gems.」との説明文。ということはこれ、要らないのでは？外す。</p>

<pre><code class="language-bash">Could not find gem 'rake-compiler (~&gt; 0.9.4)' in any of the gem sources listed in your Gemfile.
</code></pre>

<pre><code class="language-bash">Package: rake-compiler
Version: 1.0.5-1
</code></pre>

<p>なんだよもー。これもバージョン外してやってみよう。</p>

<pre><code class="language-bash">/usr/bin/ruby2.5 /usr/bin/rspec --pattern ./spec/\*\*/\*_spec.rb --format documentation failed
ERROR: Test &quot;ruby2.5&quot; failed. Exiting.
dh_auto_install: dh_ruby --install /build/ruby-serverengine-2.1.0/debian/ruby-serverengine returned exit code 1
make: *** [debian/rules:6: binary] Error 1
</code></pre>

<p>うーん、どこかのテストがエラーになるな。1個ずつやってみよう。。。。あれ、エラー吐いてるのにテストが問題ないとなるのもあるね…。</p>

<pre><code class="language-bash">ServerEngine::Supervisor
  initialize error
  when :log=IO option is given
I, [2019-04-03T14:37:32.253000 #27406]  INFO -- : Received graceful stop
    can start
  when :logger option is given
I, [2019-04-03T14:37:33.055374 #27406]  INFO -- : Received graceful stop
    uses specified logger instance
  when both :logger and :log options are given
I, [2019-04-03T14:37:33.857608 #27406]  INFO -- : Received graceful stop
    start ignoring :log
  when using signal as command_sender
I, [2019-04-03T14:37:34.664887 #27574]  INFO -- : Received graceful stop
I, [2019-04-03T14:37:34.862993 #27406]  INFO -- : Server finished with status 0
    start and graceful stop
I, [2019-04-03T14:37:35.671015 #27594]  INFO -- : Received immediate stop
I, [2019-04-03T14:37:35.870587 #27406]  INFO -- : Server finished with status 0
    immediate stop
I, [2019-04-03T14:37:36.678895 #27615]  INFO -- : Received graceful restart
I, [2019-04-03T14:37:37.477583 #27615]  INFO -- : Received graceful stop
I, [2019-04-03T14:37:37.879210 #27406]  INFO -- : Server finished with status 0
    graceful restart
I, [2019-04-03T14:37:38.686002 #27654]  INFO -- : Received immediate restart
I, [2019-04-03T14:37:39.489342 #27654]  INFO -- : Received graceful stop
I, [2019-04-03T14:37:39.886976 #27406]  INFO -- : Server finished with status 0
    immediate restart
I, [2019-04-03T14:37:40.691983 #27688]  INFO -- : Received reload
I, [2019-04-03T14:37:40.692981 #27688]  INFO -- : Received graceful stop
I, [2019-04-03T14:37:40.892738 #27406]  INFO -- : Server finished with status 0
    reload
Unexpected error error test
  /build/ruby-serverengine-2.1.0/spec/server_worker_context.rb:223:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/worker.rb:81:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/embedded_server.rb:26:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:128:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:269:in `block in start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:134:in `block in fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:260:in `start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:195:in `main'
  /build/ruby-serverengine-2.1.0/spec/supervisor_spec.rb:10:in `block in start_supervisor'
I, [2019-04-03T14:37:41.398888 #27406]  INFO -- : Server finished unexpectedly with status 1
Unexpected error error test
  /build/ruby-serverengine-2.1.0/spec/server_worker_context.rb:223:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/worker.rb:81:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/embedded_server.rb:26:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:128:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:269:in `block in start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:134:in `block in fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:260:in `start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:307:in `reboot_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:208:in `main'
  /build/ruby-serverengine-2.1.0/spec/supervisor_spec.rb:10:in `block in start_supervisor'
I, [2019-04-03T14:37:42.401104 #27406]  INFO -- : Server finished unexpectedly with status 1
Unexpected error error test
  /build/ruby-serverengine-2.1.0/spec/server_worker_context.rb:223:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/worker.rb:81:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/embedded_server.rb:26:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:128:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:269:in `block in start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:134:in `block in fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:260:in `start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:307:in `reboot_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:208:in `main'
  /build/ruby-serverengine-2.1.0/spec/supervisor_spec.rb:10:in `block in start_supervisor'
I, [2019-04-03T14:37:43.400219 #27406]  INFO -- : Server finished with status 1
    auto restart in limited ratio
  when using pipe as command_sender
I, [2019-04-03T14:37:44.204850 #27757]  INFO -- : Received graceful stop
#&lt;Thread:0x000055ddba860f40@/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:81 run&gt; terminated with exception (report_on_exception is true):
/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:83:in `block in install_signal_handlers': undefined method `chomp' for nil:NilClass (NoMethodError)
I, [2019-04-03T14:37:44.408173 #27406]  INFO -- : Server finished with status 0
    start and graceful stop
I, [2019-04-03T14:37:45.215304 #27780]  INFO -- : Received immediate stop
#&lt;Thread:0x000055ddba97e760@/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:81 run&gt; terminated with exception (report_on_exception is true):
/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:83:in `block in install_signal_handlers': undefined method `chomp' for nil:NilClass (NoMethodError)
    immediate stop
I, [2019-04-03T14:37:45.414819 #27406]  INFO -- : Server finished with status 0
I, [2019-04-03T14:37:46.220865 #27799]  INFO -- : Received graceful restart
I, [2019-04-03T14:37:47.024452 #27799]  INFO -- : Received graceful stop
#&lt;Thread:0x000055ddba9fa6f8@/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:81 run&gt; terminated with exception (report_on_exception is true):
/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:83:in `block in install_signal_handlers': undefined method `chomp' for nil:NilClass (NoMethodError)
I, [2019-04-03T14:37:47.421282 #27406]  INFO -- : Server finished with status 0
    graceful restart
I, [2019-04-03T14:37:48.227456 #27837]  INFO -- : Received immediate restart
I, [2019-04-03T14:37:49.029153 #27837]  INFO -- : Received graceful stop
#&lt;Thread:0x000055ddbaaa8af0@/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:81 run&gt; terminated with exception (report_on_exception is true):
/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:83:in `block in install_signal_handlers': undefined method `chomp' for nil:NilClass (NoMethodError)
I, [2019-04-03T14:37:49.429525 #27406]  INFO -- : Server finished with status 0
    immediate restart
I, [2019-04-03T14:37:50.238952 #27872]  INFO -- : Received reload
I, [2019-04-03T14:37:50.240958 #27872]  INFO -- : Received graceful stop
#&lt;Thread:0x000055ddba9cc2a8@/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:81 run&gt; terminated with exception (report_on_exception is true):
/build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:83:in `block in install_signal_handlers': undefined method `chomp' for nil:NilClass (NoMethodError)
I, [2019-04-03T14:37:50.439080 #27406]  INFO -- : Server finished with status 0
    reload
Unexpected error error test
  /build/ruby-serverengine-2.1.0/spec/server_worker_context.rb:223:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/worker.rb:81:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/embedded_server.rb:26:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:128:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:269:in `block in start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:134:in `block in fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:260:in `start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:195:in `main'
  /build/ruby-serverengine-2.1.0/spec/supervisor_spec.rb:10:in `block in start_supervisor'
I, [2019-04-03T14:37:50.943666 #27406]  INFO -- : Server finished unexpectedly with status 1
Unexpected error error test
  /build/ruby-serverengine-2.1.0/spec/server_worker_context.rb:223:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/worker.rb:81:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/embedded_server.rb:26:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:128:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:269:in `block in start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:134:in `block in fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:260:in `start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:307:in `reboot_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:208:in `main'
  /build/ruby-serverengine-2.1.0/spec/supervisor_spec.rb:10:in `block in start_supervisor'
I, [2019-04-03T14:37:51.944788 #27406]  INFO -- : Server finished unexpectedly with status 1
Unexpected error error test
  /build/ruby-serverengine-2.1.0/spec/server_worker_context.rb:223:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/worker.rb:81:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/embedded_server.rb:26:in `run'
  /build/ruby-serverengine-2.1.0/lib/serverengine/server.rb:128:in `main'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:269:in `block in start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:134:in `block in fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/process_manager.rb:126:in `fork'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:260:in `start_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:307:in `reboot_server'
  /build/ruby-serverengine-2.1.0/lib/serverengine/supervisor.rb:208:in `main'
  /build/ruby-serverengine-2.1.0/spec/supervisor_spec.rb:10:in `block in start_supervisor'
I, [2019-04-03T14:37:52.946855 #27406]  INFO -- : Server finished with status 1
    auto restart in limited ratio


1 deprecation warning total
Deprecation Warnings:

Finished in 24.13 seconds (files took 0.26415 seconds to load)
28 examples, 0 failures
</code></pre>

<pre><code class="language-bash">ServerEngine::MultiThreadServer
I, [2019-04-03T14:44:36.057152 #3330]  INFO -- : Received reload
I, [2019-04-03T14:44:37.558054 #3330]  INFO -- : Received graceful stop
  scale up
I, [2019-04-03T14:44:38.560735 #3330]  INFO -- : Received graceful restart
I, [2019-04-03T14:44:40.061600 #3330]  INFO -- : Received graceful stop
  scale down
/usr/bin/ruby2.5 /usr/bin/rspec --pattern ./spec/\*\*/multi_process\*_spec.rb --format documentation failed
ERROR: Test &quot;ruby2.5&quot; failed. Exiting.
</code></pre>

<p><code>spec/multi_process_server_spec.rb</code>がコケてる</p>

<pre><code class="language-ruby">    it 'raises SystemExit when all workers exit with specified code by unrecoverable_exit_codes' do
      pending &quot;unrecoverable_exit_codes supported only for multi process workers&quot; if impl_class == ServerEngine::MultiThreadServer
      pending &quot;Windows environment does not support fork&quot; if ServerEngine.windows? &amp;&amp; impl_class == ServerEngine::MultiProcessServer

      config = {workers: 4, log_stdout: false, log_stderr: false, unrecoverable_exit_codes: [3, 4, 5]}

      s = impl_class.new(TestExitWorker) { config.dup }
      raised_error = nil
      t = Thread.new do
        begin
          s.main
        rescue SystemExit =&gt; e
          raised_error = e
        end
      end

      wait_for_fork
      test_state(:worker_run).should == 4
      t.join

      test_state(:worker_stop).to_i.should == 0
      raised_error.status.should == 3 # 4th process's exit status
    end

    it 'raises SystemExit immediately when a worker exits if stop_immediately_at_unrecoverable_exit specified' do
      pending &quot;unrecoverable_exit_codes supported only for multi process workers&quot; if impl_class == ServerEngine::MultiThreadServer
      pending &quot;Windows environment does not support fork&quot; if ServerEngine.windows? &amp;&amp; impl_class == ServerEngine::MultiProcessServer

      config = {workers: 4, log_stdout: false, log_stderr: false, unrecoverable_exit_codes: [3, 4, 5], stop_immediately_at_unrecoverable_exit: true}

      s = impl_class.new(TestExitWorker) { config.dup }
      raised_error = nil
      t = Thread.new do
        begin
          s.main
        rescue SystemExit =&gt; e
          raised_error = e
        end
      end

      wait_for_fork
      test_state(:worker_run).should == 4
      t.join

      test_state(:worker_stop).to_i.should == 3
      test_state(:worker_finished).to_i.should == 3
      raised_error.should_not be_nil
      raised_error.status.should == 5 # 1st process's exit status
    end
</code></pre>

<p>うーん。とりあえず該当のテストを無効にしておくか。</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/04/02/%E3%82%81%E3%82%93%E3%81%A6%E3%81%AA%E3%81%AE%E3%81%8A%E3%81%97%E3%81%94%E3%81%A8/">めんてなのおしごと</a></h3>
						<small><span class="label label-primary">
							
								Tue, Apr 2, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<ul>
<li>ubuntu-keyringのunblockが進まないので<a href="https://lists.debian.org/debian-release/2019/04/msg00039.html">ping</a>。tomoyo-toolsは<a href="https://lists.debian.org/debian-release/2019/04/msg00040.html">閉じた</a>。</li>
<li>itamaeのバグの話がlaunchpadに上がってるのを見たので、<a href="https://tracker.debian.org/news/1037156/accepted-itamae-1910-2-source-into-unstable/">Debian側に報告&amp;修正してアップロードした</a>。どうせあっちでは何もやらんでしょ…。あとでunblockもしとかないと。忘れそうだ…</li>
<li>itamaeのバージョンが古いので、新しいのを作業…と依存関係で<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=926236">ruby-fluentd-loggerのパッケージ申請を登録</a>。あらかた終わったけど、テスト実行どうやるんだっけ…。</li>
</ul>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/03/31/%E3%82%81%E3%82%93%E3%81%A6%E3%81%AA%E3%81%AE%E3%81%8A%E3%81%97%E3%81%94%E3%81%A8/">めんてなのおしごと</a></h3>
						<small><span class="label label-primary">
							
								Sun, Mar 31, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<ul>
<li><a href="https://tracker.debian.org/news/1036912/accepted-snapper-083-1-source-into-unstable/">snapper</a>をアップデートした</li>
<li><a href="https://tracker.debian.org/news/1036925/accepted-fonts-sawarabi-mincho-20190317-1-source-into-unstable/">fonts-sawarabi-mincho</a>をアップデートした</li>
<li><a href="https://tracker.debian.org/news/1036914/accepted-ruby-aruba-0149-1-source-into-unstable/">ruby-aruba</a>をアップデートした</li>
<li><a href="https://tracker.debian.org/news/1036928/accepted-libuninameslist-20190305-1-source-into-unstable/">libuninameslist</a>をアップデートした</li>
</ul>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/03/30/%E3%82%81%E3%82%93%E3%81%A6%E3%81%AA%E3%81%AE%E3%81%8A%E3%81%97%E3%81%94%E3%81%A8/">めんてなのおしごと</a></h3>
						<small><span class="label label-primary">
							
								Sat, Mar 30, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
								 , 
							<a href="/blog/tags/unblock">unblock</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p><a href="https://lists.debian.org/debian-release/2019/03/msg01174.html">jcodingsのunblock</a>を出した</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/03/26/%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E7%B5%82%E4%BA%86%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AE%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96%E5%89%8A%E9%99%A4%E3%81%AB%E5%AF%84%E3%81%9B%E3%81%A6/">サポート終了コンポーネントのアーカイブ削除に寄せて</a></h3>
						<small><span class="label label-primary">
							
								Tue, Mar 26, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
								 , 
							<a href="/blog/tags/release">release</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p>先日、ミラーアーカイブからDebian7とDebian8のサポート終了コンポーネントが削除されました。すると、Docker使ってる人やCircleCI使ってる人が「ぎゃー！」と叫び始めたという。どうも背景を理解されてる方は少ないようなので、簡単にざっと説明を書きました（ユーザーならともかく、イメージを提供するベンダー側は把握しておいてほしいですけどね…）。</p>

<p>ベースイメージとしてDebian8 &ldquo;jessie&rdquo;を使っているという前提で話をします。</p>

<ul>
<li>Debian8はDebian9のリリースに伴って<code>「oldstable」（旧安定版）</code>という扱いになっています。oldstableはstableに比べて限定されたサポートの提供となります。そりゃぁでっかいリポジトリを複数バージョンに渡って長期間メンテナンスなんて難しいですからね。oldstable使ってる時点で色々制限が出てくる、ってもんです。ベストプラクティスとしては「<strong>ベースイメージのDebianはstableを使おう</strong>」です。

<ul>
<li>え？Ubuntu LTSだってでっかいリポジトリで長期間サポートしてるじゃん、って？…彼らは2000パッケージぐらいのmainコンポーネントはサポートしてるけど、その他の50000パッケージぐらいのuniverseはコミュニティに寄るサポート≒Debianその他から持ってくるよ、という状態なんですよ。知らなかったでしょ？</li>
</ul></li>
<li><code>jessie-updates</code>コンポーネントが無くてビルドがー！という人：<code>-updates</code>は「stableにおけるパッケージのうち、定期的な更新が必要なものを提供」という位置づけなので、<strong>jessieがoldstableになった時点で死んでます</strong>。外しちゃえばいいです。</li>
<li><strong>(追記)</strong> <code>http://security.debian.org/debian-security jessie/updates mainも削除…はしちゃダメです！</code> その行は<code>セキュリティアップデートの取得</code>です（取得先サーバーがsecurity.debian.orgでしょ？) たしかに<code>jessie/updates</code>というところだけを見たら削除したくなるかもしれませんが、LTSサポートのセキュリティアップデートが降ってくるのを消したらアカンですよ…。</li>
<li><code>jessie-backports</code>が無くなってギャー！という人：<code>-backports</code>は「stableへの新しいバージョンの移植」という位置づけのコンポーネントなので、<strong>jessieがoldstableになった時点で死んでます</strong>。なんで使ってんの？ということです。そもそも新しいバージョンが必要だ、というならoldstable使ってる時点で前提がおかしいですよ？まずはstableに移行しましょう</li>
</ul>

<p>Debian9がでて早２年近く、そろそろDebian10の足音も聞こえてるので、開発側としてはいまさらDebian8に固執してほしくはない、というのが正直な所。ベースイメージのバージョン移行は計画的に…。</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/03/24/%E3%82%81%E3%82%93%E3%81%A6%E3%81%AA%E3%81%AE%E3%81%8A%E3%81%97%E3%81%94%E3%81%A8/">めんてなのおしごと</a></h3>
						<small><span class="label label-primary">
							
								Sun, Mar 24, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
								 , 
							<a href="/blog/tags/unblock">unblock</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<ul>
<li>tomoyo-toolsも一応<a href="https://lists.debian.org/debian-release/2019/03/msg00905.html">unblockを出した</a>。通らないかもしれないけど、一応そこまでdiffがでかくないよ―というアピール。

<ul>
<li>→ダメだった。そらそーか。</li>
</ul></li>
<li>squid-deb-proxyは問い合わせてみたが特に反応がないが、週末だったので<code>--deleyed 3</code>でアップロードした。</li>
</ul>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/03/23/%E3%82%81%E3%82%93%E3%81%A6%E3%81%AA%E3%81%AE%E3%81%8A%E3%81%97%E3%81%94%E3%81%A8/">めんてなのおしごと</a></h3>
						<small><span class="label label-primary">
							
								Sat, Mar 23, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
								 , 
							<a href="/blog/tags/unblock">unblock</a>
						
								 , 
							<a href="/blog/tags/bts">bts</a>
						
								 , 
							<a href="/blog/tags/release">release</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p>今回は<code>ubuntu-keyring</code>パッケージを題材に「full freeze期間に入ってしまったが、unstableにあるパッケージをリリース対象＝testingに入れたい」場合の手順をメモしてみました。</p>

<hr />

<p>まず、testingにあるバージョンとunstableにあるバージョンの差分（diff）を生成します。今だと<code>git diff</code>でも良さそうな気はするのですが、慣例的にはソースパッケージに対して<code>debdiff</code>を使って作ります。ソースパッケージを<code>dget</code>コマンドで取得し、<code>.dsc</code>ファイルに対して<code>debdiff</code>コマンドを実行しています。ソースパッケージのURLは<a href="https://tracker.debian.org/pkg/ubuntu-keyring">distro tracker</a>からコピペしていますが、別のやり方もあるでしょう。</p>

<pre><code class="language-bash">$ dget http://deb.debian.org/debian/pool/main/u/ubuntu-keyring/ubuntu-keyring_2018.09.18.1-4.dsc \
       http://deb.debian.org/debian/pool/main/u/ubuntu-keyring/ubuntu-keyring_2018.09.18.1-5.dsc
$ debdiff ubuntu-keyring_2018.09.18.1-4.dsc ubuntu-keyring_2018.09.18.1-5.dsc &gt; ubuntu-keyring.diff
</code></pre>

<p>diffが出来たので、これを元に<code>unblockリクエスト</code>をバグ登録します。ツールとしては<code>reportbug</code>コマンドを使うとウィザード形式で行ってくれるので間違いがなくて楽です。reportbugは<code>reportbug &lt;package&gt;</code>という形でパッケージを指定してバグ登録するのですが、今回のような場合はリリース関連の調整をトラッキングするための疑似パッケージ(psuedo package)である<code>release.debian.org</code>を指定します。</p>

<pre><code class="language-bash">$ reportbug release.debian.org
Detected character set: UTF-8
Please change your locale if this is incorrect.

Using 'Hideki Yamane &lt;henrich@debian.org&gt;' as your from address.
Will send report to Debian (per lsb_release).
What sort of request is this? (If none of these things mean anything to you, or you are trying to report a bug in an existing package, please press Enter to exit reportbug.)

1 binnmu      binNMU requests
2 britney     testing migration script bugs
3 other       None of the other options
4 rm          Stable/Testing removal requests
5 stretch-pu  stretch proposed updates requests
6 transition  transition tracking
7 unblock     unblock requests

Choose the request type:
</code></pre>

<p>今回行いたいのはunblockなので<code>&quot;7&quot;</code>を選びます。続けて対象となるパッケージ名（今回は<code>ubuntu-keyring</code>）を入力します。</p>

<pre><code class="language-bash">Choose the request type: 7
Please enter the name of the package: ubuntu-keyring
Checking status database...
Latest version seems to be 2018.09.18.1-1, is this the proper one ? [Y|n|?]?
</code></pre>

<p>最新バージョンのチェックが行われます…あれ？間違ってますね。なんでだろう？このバージョンはtestingにも無いんですが…謎だ。仕方がないので<code>&quot;n&quot;</code>を入力して現在の最新版である<code>2018.09.18.1-5</code>を入力。</p>

<pre><code class="language-bash">Latest version seems to be 2018.09.18.1-1, is this the proper one ? [Y|n|?]? n
Please enter the version of the package: 2018.09.18.1-5
</code></pre>

<p>するとテンプレートが埋められて雛形が出来上がり、<code>sensible-editor</code>で指定されたエディタが立ち上がります</p>

<pre><code class="language-text">Subject: unblock: ubuntu-keyring/2018.09.18.1-5
Package: release.debian.org
User: release.debian.org@packages.debian.org
Usertags: unblock
Severity: normal

Please unblock package ubuntu-keyring

(explain the reason for the unblock here)

(include/attach the debdiff against the package in testing)

unblock ubuntu-keyring/2018.09.18.1-5

-- System Information:
Debian Release: buster/sid
  APT prefers unstable
  APT policy: (500, 'unstable'), (1, 'experimental')
Architecture: amd64 (x86_64)

Kernel: Linux 4.19.0-3-amd64 (SMP w/4 CPU cores)
Kernel taint flags: TAINT_OOT_MODULE, TAINT_UNSIGNED_MODULE
Locale: LANG=ja_JP.UTF-8, LC_CTYPE=ja_JP.UTF-8 (charmap=UTF-8), LANGUAGE=ja_JP.UTF-8 (charmap=UTF-8)
Shell: /bin/sh linked to /bin/dash
Init: systemd (via /run/systemd/system)
LSM: AppArmor: enabled
</code></pre>

<p><code>(include/attach the debdiff against the package in testing)</code>の所を消して、先程作ったdiffを貼り付け、<code>(explain the reason for the unblock here)</code>のところに理由を書いて送ります。出来上がりはこんな感じ。</p>

<pre><code class="language-text">Package: release.debian.org
Severity: normal
User: release.debian.org@packages.debian.org
Usertags: unblock

 Please unblock package ubuntu-keyring

 * This update fixes file removal at maintainer script, and also deals with symlink
   removal that the package in testing doesn't create properly as below

&gt;&gt;      # force remove garbage that was created by previous version, oh moron...
&gt;&gt;      rm -f /etc/apt/trusted.gpg.d/ubuntu-keyring-2012-cloud-archive\,\ ubuntu-cloud-removed-keys.gpg

 * ubuntu-keyring is leaf package, no package will be affected with this
   change if there would be a regression ;)

&gt;&gt; $ apt-rdepends -r ubuntu-keyring
&gt;&gt; ubuntu-keyring
&gt;&gt;  Reverse Depends: ubuntu-archive-keyring (2018.09.18.1-5)

 ubuntu-archive-keyring is just a transitional package.


 Here's a debdiff.

diff -Nru ubuntu-keyring-2018.09.18.1/debian/changelog ubuntu-keyring-2018.09.18.1/debian/changelog
--- ubuntu-keyring-2018.09.18.1/debian/changelog	2019-02-07 00:26:23.000000000 +0900
+++ ubuntu-keyring-2018.09.18.1/debian/changelog	2019-03-12 01:40:45.000000000 +0900
@@ -1,3 +1,16 @@
+ubuntu-keyring (2018.09.18.1-5) unstable; urgency=medium
+
+  * debian/*.post{inst,rm}
+    - use apt-config(8)'s Dir::Etc::trustedparts and fix keyring removal error.
+      Thanks to Linda Lapinlampi &lt;linda@lindalap.fi&gt; and
+      Hiroyuki YAMAMORI &lt;h-yamamo@db3.so-net.ne.jp&gt; (Closes: #922176, #922177)
+  * debian/ubuntu-dbgsym-keyring.templates
+    - add ubuntu-dbgsym-keyring.gpg (See #922348)
+  * debian/control
+    - add Rules-Requires-Root: no
+
+ -- Hideki Yamane &lt;henrich@debian.org&gt;  Tue, 12 Mar 2019 01:40:45 +0900
+
 ubuntu-keyring (2018.09.18.1-4) unstable; urgency=medium
 
   * debian/control
diff -Nru ubuntu-keyring-2018.09.18.1/debian/control ubuntu-keyring-2018.09.18.1/debian/control
--- ubuntu-keyring-2018.09.18.1/debian/control	2019-02-07 00:26:23.000000000 +0900
+++ ubuntu-keyring-2018.09.18.1/debian/control	2019-03-12 01:40:45.000000000 +0900
@@ -8,6 +8,7 @@
 Homepage: https://launchpad.net/ubuntu/+source/ubuntu-keyring
 Vcs-Git: https://salsa.debian.org/debian/ubuntu-keyring.git
 Vcs-Browser: https://salsa.debian.org/debian/ubuntu-keyring
+Rules-Requires-Root: no
 
 Package: ubuntu-archive-keyring
 Architecture: all
diff -Nru ubuntu-keyring-2018.09.18.1/debian/ubuntu-cloud-keyring.postinst ubuntu-keyring-2018.09.18.1/debian/ubuntu-cloud-keyring.postinst
--- ubuntu-keyring-2018.09.18.1/debian/ubuntu-cloud-keyring.postinst	2019-02-07 00:26:23.000000000 +0900
+++ ubuntu-keyring-2018.09.18.1/debian/ubuntu-cloud-keyring.postinst	2019-03-12 01:40:45.000000000 +0900
@@ -5,15 +5,26 @@
 case &quot;$1&quot; in
     install|configure)
 
+      # force remove garbage that was created by previous version, oh moron...
+      rm -f /etc/apt/trusted.gpg.d/ubuntu-keyring-2012-cloud-archive\,\ ubuntu-cloud-removed-keys.gpg
+
+
+      TRUSTEDPARTS=&quot;/etc/apt/trusted.gpg.d/&quot;
+      eval &quot;$(apt-config shell TRUSTEDPARTS Dir::Etc::trustedparts/d)&quot;
+
+      # once clean up keyrings
+      rm -f &quot;${TRUSTEDPARTS}ubuntu-keyring-2012-cloud-archive.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-keyring-2012-removed-keys.gpg&quot;
+
       . /usr/share/debconf/confmodule
       db_version 2.0
       db_get ubuntu-cloud-keyring/keyring
 
       if [ -n &quot;$RET&quot; ]; then
-        for keyring in &quot;$RET&quot;
+        selected=$(echo &quot;$RET&quot; | sed -e 's/, /\n/g')
+        echo &quot;$selected&quot; | while read keyring
         do
-          rm -f /etc/apt/trusted.gpg.d/&quot;$keyring&quot;.gpg
-          ln -sf /usr/share/keyrings/&quot;$keyring&quot;.gpg /etc/apt/trusted.gpg.d/
+          ln -sf &quot;/usr/share/keyrings/${keyring}.gpg&quot; &quot;$TRUSTEDPARTS&quot;
         done
       fi
 
diff -Nru ubuntu-keyring-2018.09.18.1/debian/ubuntu-cloud-keyring.postrm ubuntu-keyring-2018.09.18.1/debian/ubuntu-cloud-keyring.postrm
--- ubuntu-keyring-2018.09.18.1/debian/ubuntu-cloud-keyring.postrm	2019-02-07 00:26:23.000000000 +0900
+++ ubuntu-keyring-2018.09.18.1/debian/ubuntu-cloud-keyring.postrm	2019-03-12 01:40:45.000000000 +0900
@@ -5,9 +5,12 @@
 case &quot;$1&quot; in
     purge|remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
 
-        rm -f /etc/apt/trusted.gpg.d/ubuntu-keyring-2012-cloud-archive.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-cloud-removed-keys.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-cloud-keyring.gpg
+        TRUSTEDPARTS=&quot;/etc/apt/trusted.gpg.d/&quot;
+        eval &quot;$(apt-config shell TRUSTEDPARTS Dir::Etc::trustedparts/d)&quot;
+
+        rm -f &quot;${TRUSTEDPARTS}ubuntu-keyring-2012-cloud-archive.gpg&quot; \
+              &quot;${TRUSTEDPARTS}ubuntu-cloud-removed-keys.gpg&quot; \
+              &quot;${TRUSTEDPARTS}ubuntu-cloud-keyring.gpg&quot;
 
     ;;
     *)
diff -Nru ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.postinst ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.postinst
--- ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.postinst	2019-02-07 00:26:23.000000000 +0900
+++ ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.postinst	2019-03-12 01:40:45.000000000 +0900
@@ -5,15 +5,28 @@
 case &quot;$1&quot; in
     install|configure)
 
+      # remove garbage that was created by previous version, oh moron...
+      rm -f /etc/apt/trusted.gpg.d/ubuntu-keyring-2016-dbgsym.gpg\,\ *
+      rm -f /etc/apt/trusted.gpg.d/ubuntu-dbgsym-removed-keys.gpg\,\ *
+
+
+      TRUSTEDPARTS=&quot;/etc/apt/trusted.gpg.d/&quot;
+      eval &quot;$(apt-config shell TRUSTEDPARTS Dir::Etc::trustedparts/d)&quot;
+
+      # once clean up keyrings
+      rm -f &quot;${TRUSTEDPARTS}ubuntu-keyring-2016-dbgsym.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-dbgsym-removed-keys.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-dbgsym-keyring.gpg&quot;
+
       . /usr/share/debconf/confmodule
       db_version 2.0
       db_get ubuntu-dbgsym-keyring/keyring
 
       if [ -n &quot;$RET&quot; ]; then
-        for keyring in &quot;$RET&quot;
+        selected=$(echo &quot;$RET&quot; | sed -e 's/, /\n/g')
+        echo &quot;$selected&quot; | while read keyring
         do
-          rm -f /etc/apt/trusted.gpg.d/&quot;$keyring&quot;.gpg
-          ln -sf /usr/share/keyrings/&quot;$keyring&quot;.gpg /etc/apt/trusted.gpg.d/
+          ln -sf &quot;/usr/share/keyrings/${keyring}.gpg&quot; &quot;$TRUSTEDPARTS&quot;
         done
       fi
 
diff -Nru ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.postrm ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.postrm
--- ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.postrm	2019-02-07 00:26:23.000000000 +0900
+++ ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.postrm	2019-03-12 01:40:45.000000000 +0900
@@ -5,9 +5,12 @@
 case &quot;$1&quot; in
     purge|remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
 
-        rm -f /etc/apt/trusted.gpg.d/ubuntu-keyring-2016-dbgsym.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-dbgsym-removed-keys.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-dbgsym-keyring.gpg
+        TRUSTEDPARTS=&quot;/etc/apt/trusted.gpg.d/&quot;
+        eval &quot;$(apt-config shell TRUSTEDPARTS Dir::Etc::trustedparts/d)&quot;
+
+        rm -f &quot;${TRUSTEDPARTS}ubuntu-keyring-2016-dbgsym.gpg&quot; \
+              &quot;${TRUSTEDPARTS}ubuntu-dbgsym-removed-keys.gpg&quot; \
+              &quot;${TRUSTEDPARTS}ubuntu-dbgsym-keyring.gpg&quot;
 
     ;;
     *)
diff -Nru ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.templates ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.templates
--- ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.templates	2019-02-07 00:26:23.000000000 +0900
+++ ubuntu-keyring-2018.09.18.1/debian/ubuntu-dbgsym-keyring.templates	2019-03-12 01:40:45.000000000 +0900
@@ -1,6 +1,6 @@
 Template: ubuntu-dbgsym-keyring/keyring
 Type: multiselect
-Choices: ubuntu-keyring-2016-dbgsym, ubuntu-dbgsym-removed-keys
+Choices: ubuntu-dbgsym-keyring, ubuntu-keyring-2016-dbgsym, ubuntu-dbgsym-removed-keys
 Default:
 _Description: Trusted GPG keyring for package authentication
  If you want to use the Ubuntu dbgsym archive in place of the Debian archive in
diff -Nru ubuntu-keyring-2018.09.18.1/debian/ubuntu-keyring.postinst ubuntu-keyring-2018.09.18.1/debian/ubuntu-keyring.postinst
--- ubuntu-keyring-2018.09.18.1/debian/ubuntu-keyring.postinst	2019-02-07 00:26:23.000000000 +0900
+++ ubuntu-keyring-2018.09.18.1/debian/ubuntu-keyring.postinst	2019-03-12 01:40:45.000000000 +0900
@@ -12,15 +12,27 @@
               /etc/apt/trusted.gpg.d/ubuntu-archive-removed-keys.gpg
       fi
 
+      # and also remove garbage that was created by previous version.
+      # oh moron...
+      rm -f /etc/apt/trusted.gpg.d/ubuntu-keyring-201[28]-archive\,\ *
+
+      TRUSTEDPARTS=&quot;/etc/apt/trusted.gpg.d/&quot;
+      eval &quot;$(apt-config shell TRUSTEDPARTS Dir::Etc::trustedparts/d)&quot;
+
+      # once clean up keyrings
+      rm -f &quot;${TRUSTEDPARTS}ubuntu-keyring-2018-archive.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-keyring-2012-archive.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-archive-removed-keys.gpg&quot;
+
       . /usr/share/debconf/confmodule
       db_version 2.0
       db_get ubuntu-keyring/keyring
 
       if [ -n &quot;$RET&quot; ]; then
-        for keyring in &quot;$RET&quot;
+        selected=$(echo &quot;$RET&quot; | sed -e 's/, /\n/g')
+        echo &quot;$selected&quot; | while read keyring
         do
-          rm -f /etc/apt/trusted.gpg.d/&quot;$keyring&quot;.gpg
-          ln -sf /usr/share/keyrings/&quot;$keyring&quot;.gpg /etc/apt/trusted.gpg.d/
+          ln -sf &quot;/usr/share/keyrings/${keyring}.gpg&quot; &quot;$TRUSTEDPARTS&quot;
         done
       fi
 
diff -Nru ubuntu-keyring-2018.09.18.1/debian/ubuntu-keyring.postrm ubuntu-keyring-2018.09.18.1/debian/ubuntu-keyring.postrm
--- ubuntu-keyring-2018.09.18.1/debian/ubuntu-keyring.postrm	2019-02-07 00:26:23.000000000 +0900
+++ ubuntu-keyring-2018.09.18.1/debian/ubuntu-keyring.postrm	2019-03-12 01:40:45.000000000 +0900
@@ -5,14 +5,17 @@
 case &quot;$1&quot; in
     purge|remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
 
-        rm -f /etc/apt/trusted.gpg.d/ubuntu-archive-keyring.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-archive-removed-keys.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-keyring-2012-archive.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-keyring-2018-archive.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-keyring-2012-cdimage.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-cloudimage-keyring.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-cloudimage-removed-keys.gpg \
-              /etc/apt/trusted.gpg.d/ubuntu-master-keyring.gpg
+      TRUSTEDPARTS=&quot;/etc/apt/trusted.gpg.d/&quot;
+      eval &quot;$(apt-config shell TRUSTEDPARTS Dir::Etc::trustedparts/d)&quot;
+
+      rm -f &quot;${TRUSTEDPARTS}ubuntu-archive-keyring.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-archive-removed-keys.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-keyring-2012-archive.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-keyring-2018-archive.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-keyring-2012-cdimage.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-cloudimage-keyring.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-cloudimage-removed-keys.gpg&quot; \
+            &quot;${TRUSTEDPARTS}ubuntu-master-keyring.gpg&quot;
 
     ;;
     *)

unblock ubuntu-keyring/2018.09.18.1-5

-- System Information:
Debian Release: buster/sid
  APT prefers unstable
  APT policy: (500, 'unstable'), (1, 'experimental')
Architecture: amd64 (x86_64)

Kernel: Linux 4.19.0-3-amd64 (SMP w/4 CPU cores)
Kernel taint flags: TAINT_OOT_MODULE, TAINT_UNSIGNED_MODULE
Locale: LANG=ja_JP.UTF-8, LC_CTYPE=ja_JP.UTF-8 (charmap=UTF-8), LANGUAGE=ja_JP.UTF-8 (charmap=UTF-8)
Shell: /bin/sh linked to /bin/dash
Init: systemd (via /run/systemd/system)
LSM: AppArmor: enabled
</code></pre>

<p>できたらエディタから抜けて<code>&quot;y&quot;</code>で送信します。</p>

<pre><code class="language-bash">Report will be sent to Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;
Submit this report on release.debian.org (e to edit) [Y|n|a|c|e|i|l|m|p|q|d|t|s|?]? y
</code></pre>

<p>SMTPサーバーへの通信が行われ、特に問題なければ完了メッセージがでてきます。</p>

<pre><code class="language-bash">Connecting to mysmtp.example.jp:587 via SMTP...

Bug report submitted to: Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;
Copies sent to:
  Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;
  Hideki Yamane &lt;henrich@debian.org&gt;

If you want to provide additional information, please wait to receive the bug tracking number via email; you may then send any extra information to n@bugs.debian.org (e.g.
nnnnnn@bugs.debian.org), where n is the bug number. Normally you will receive an acknowledgement via email including the bug report number within an hour; if you haven't received a
confirmation, then the bug reporting process failed at some point (reportbug or MTA failure, BTS maintenance, etc.).
</code></pre>

<p>送信完了しました。しばらくするとBTSから番号が付与された完了通知が届きますので、あとはそれを確認すればよいでしょう。今回は<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=925350">Bug#925350</a>でした。</p>

<pre><code class="language-text">Thank you for filing a new Bug report with Debian.

You can follow progress on this Bug here: 925350: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=925350.

This is an automatically generated reply to let you know your message
has been received.

Your message is being forwarded to the package maintainers and other
interested parties for their attention; they will reply in due course.

Your message has been sent to the package maintainer(s):
 Debian Release Team &lt;debian-release@lists.debian.org&gt;

If you wish to submit further information on this problem, please
send it to 925350@bugs.debian.org.

Please do not send mail to owner@bugs.debian.org unless you wish
to report a problem with the Bug-tracking system.

-- 
925350: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=925350
Debian Bug Tracking System
Contact owner@bugs.debian.org with problems
</code></pre>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2019/03/21/%E3%82%81%E3%82%93%E3%81%A6%E3%81%AA%E3%81%AE%E3%81%8A%E3%81%97%E3%81%94%E3%81%A8/">めんてなのおしごと</a></h3>
						<small><span class="label label-primary">
							
								Thu, Mar 21, 2019
							</span>&nbsp;in
							
								
								<a href="/categories/debian">debian</a>
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=925048">debootstrapにバグレポート来てた</a>から確認したが、報告者がミスってるだけだった…</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
	</div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="text-center">
                    

<ul class="pagination">
    
    <li class="page-item">
        <a href="/blog/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item">
    <a href="/blog/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/blog/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/page/25/">25</a></li>
    
    
    <li class="page-item">
    <a href="/blog/page/3/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/blog/page/25/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <hr>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row col-md-12">
            <footer>
                <div class="pull-left">
                    <p>
                        &copy; 2015-  Hideki Yamane ~ Powered By <a href="http://hugo.spf13.com">Hugo</a> - version: 0.55.1 ~ <a href="https://henrich.github.io/blog//license">License</a>
                    </p>
                </div>

                
                <div class="pull-right">
                    
                    
                    
                        <a href="https://twitter.com/henrich" target="_blank">
                        <i class="fa fa-twitter-square fa-2x"></i></a>
                    
                    
                    
                    
                    
                        <a href="https://henrich.github.io/blog/index.xml" target="_blank">
                        <i class="fa fa-rss-square fa-2x"></i></a>
                    
                </div>
            </footer>
        </div>
    </div>

    
    </body>
</html>

