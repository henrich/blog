<!DOCTYPE html>
<html class="no-js" lang="en-us" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.25.1" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Forget me not...">
    <meta name="author" content="">

    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/favicon.ico">

    <title>Forget me not... &middot; Forget me not...</title>

   	
    
        <link rel="stylesheet" href="https://henrich.github.io/blog//css/theme/simplex.css">
    

    <link rel="stylesheet" href="https://henrich.github.io/blog//css/font-awesome.min.css">

   	
   	<link rel="stylesheet" href="https://henrich.github.io/blog//css/style.css">


    
    <script src="https://henrich.github.io/blog//js/jquery.min-2.1.4.js"></script>
    <script src="https://henrich.github.io/blog//js/bootstrap.min-3.3.5.js"></script>

    
    <link href="https://henrich.github.io/blog/index.xml" rel="alternate" type="application/rss+xml" title="Forget me not..." />
</head>
<body lang="en">
    
    <div class="container">
    <div class="row">
        <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="navbar-header">
                <a class="navbar-brand" href="https://henrich.github.io/blog/">Forget me not...</a>
            </div>
            <div class="navbar-collapse collapse navbar-responsive-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://henrich.github.io/blog/">Home</a></li>
                    <li><a href="https://henrich.github.io/blog//post/">Blog</a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</div>



    <div class="container">
        
        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2017/06/28/apt%E3%81%AE%E5%A5%87%E5%A6%99%E3%81%AA%E5%87%BA%E5%8A%9B/">aptの奇妙な出力</a></h3>
						<small><span class="label label-primary">
							
								Wed, Jun 28, 2017
							</span>&nbsp;in
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<pre><code>582 MB を 7分 1秒 で取得しました (1,382 kB/s)                                                                                                                                                               
Calling ['apt-get', '-qq', 'changelog', 'console-setup-linux=1.165'] to retrive changelog
Calling ['apt-get', '-qq', 'changelog', 'libavutil55=7:3.2.6-1+b3'] to retrive changelog
Calling ['apt-get', '-qq', 'changelog', 'gvfs-backends=1.30.4-1+b1'] to retrive changelog
Calling ['apt-get', '-qq', 'changelog', 'vlc-plugin-notify=2.2.6-2+b3'] to retrive changelog
Calling ['apt-get', '-qq', 'changelog', 'vlc-plugin-visualization=2.2.6-2+b3'] to retrive changelog
Calling ['apt-get', '-qq', 'changelog', 'vlc-plugin-skins2=2.2.6-2+b3'] to retrive changelog
Calling ['apt-get', '-qq', 'changelog', 'vlc=2.2.6-2+b3'] to retrive changelog
Calling ['apt-get', '-qq', 'changelog', 'mplayer=2:1.3.0-6+b3'] to retrive changelog
Calling ['apt-get', '-qq', 'changelog', 'gstreamer1.0-plugins-bad=1.12.1-1+b1'] to retrive changelog
changelog を読んでいます... 完了
</code></pre>

<p>??? 何故こんな出力が？</p>

<pre><code>Package: apt
Version: 1.4.6
</code></pre>

<pre><code>Package: apt-listchanges
Version: 3.12
</code></pre>

<p>どちらだろうか？</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2017/06/28/%E4%B9%85%E3%80%85%E3%81%ABbackports/">久々にbackports</a></h3>
						<small><span class="label label-primary">
							
								Wed, Jun 28, 2017
							</span>&nbsp;in
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p>そういえばjdがstretchに入らなかったのだった。stretch-backportsに入れるか。久々にbackportsを使うのでサッパリ忘れていた。debian/stretch-backportsブランチを作り、dch &ndash;bpoでchangelog作成&hellip;（この時点ではdevscriptsが更新されて無くてjessie-backportsが指定されてしまったのでそれも直す。）</p>

<p>次にbase.cowを作る。</p>

<pre><code>$ sudo cowbuilder --create --distribution stretch --basepath /var/cache/pbuilder/stretch.cow
</code></pre>

<p>あとはビルドするだけ。。。でもlintianが<a href="https://lintian.debian.org/tags/backports-changes-missing.html">backports-changes-missing</a>なる警告を出す。ふむふむ。。。</p>

<pre><code>It is recommended to include all changelog entries since the last version on debian-backports or since stable if it's the first version. You should do this by passing &quot;-v&quot; to dpkg-buildpackage. Eg: &quot;debuild -v0.7.5-2&quot;, where &quot;0.7.5-2&quot; is the version in stable. If the package wasn't in stable or backports before you don't have include the changelog entries (but you are free to do so). It helps others to follow the changes introduced with the backport (by reading the changes mailing list).
</code></pre>

<p>なるほど。-v<version> とすればいい。しかし、gbpへのオプションとしてはどうなるのかな？と思ったが、単にpbuilderのmanを見てoptionを探せばいいだけだった。&ndash;debbuildoptsを指定、ね。</p>

<pre><code>$ gbp buildpackage --git-pbuilder --git-pbuilder-options=&quot;--basepath /var/cache/pbuilder/stretch.cow --distribution stretch --debbuildopts -v1:2.8.8-140601-4&quot; --git-ignore-branch
</code></pre>

<p>以上でアップロード。</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2017/06/27/epoch%E4%BB%98%E3%81%8D%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%A0%E3%81%A8pristine-tar%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%8B%E3%82%89%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%A2%E3%82%A6%E3%83%88%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84/">epoch付きバージョンだとpristine-tarブランチからチェックアウトできない</a></h3>
						<small><span class="label label-primary">
							
								Tue, Jun 27, 2017
							</span>&nbsp;in
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<pre><code>$ gbp buildpackage --git-pbuilder --git-pristine-tar --git-tag
gbp:info: Tarballs 'xfonts-kappa20_0.396.orig.tar.xz' not found at '../tarballs/'
gbp:error: Pristine-tar couldn't checkout &quot;xfonts-kappa20_0.396.orig.tar.xz&quot;: fatal: Path 'xfonts-kappa20_0.396.orig.tar.xz.delta' does not exist in 'refs/heads/pristine-tar'
pristine-tar: git show refs/heads/pristine-tar:xfonts-kappa20_0.396.orig.tar.xz.delta failed
</code></pre>

<p>何故かprsistine-tarブランチからtarballがチェックアウトできないとな。</p>

<pre><code>henrich@hp:~/src/pkg-fonts/xfonts-kappa20(master)$ git checkout pristine-tar
Switched to branch 'pristine-tar'
henrich@hp:~/src/pkg-fonts/xfonts-kappa20(pristine-tar)$ ls
Kappa20-0.396.tar.bz2.delta  Kappa20-0.396.tar.bz2.id  xfonts-kappa20_1:0.396.orig.tar.xz.delta  xfonts-kappa20_1:0.396.orig.tar.xz.id
</code></pre>

<p>ある。どうやら、バージョン番号にepochが付くとダメっぽい。どうするよ。。。</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2017/06/26/%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E5%80%A4%E3%81%8C%E4%B8%80%E8%87%B4%E3%81%97%E3%81%AA%E3%81%84orig.tarball%E3%81%A7%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89%E3%81%8C%E8%B9%B4%E3%82%89%E3%82%8C%E3%82%8B%E6%99%82/">ハッシュ値が一致しないorig.tarballでアップロードが蹴られる時</a></h3>
						<small><span class="label label-primary">
							
								Mon, Jun 26, 2017
							</span>&nbsp;in
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p>git-buildpackageでビルドしたのだけど、pristine-tarブランチに作られたファイルから生成されるtarballと最初にアップロードしたorig.tarballとハッシュ値が違うということで蹴られることがある。tarballは都度若干違う値になっちゃうから、そもそもgbp import-origした際にキチンとpristine-tar作るようにしてあるはず、なんだけど、ミスをすることが多々&hellip;</p>

<p>で、どうやってリカバリするかというと、apt source して orig.tarball を差し替える（ダメな場当たり対応。良くやる）というのが思いつくのだけど、ちゃんとpristine-tarブランチのファイルを置き換えた方が良い。</p>

<p>とはいうものの、このブランチのファイル、どうやって生成しているのかよく分かってない。いっつも単にimport-origしてただけだし。うーん。</p>

<p>色々試行錯誤した末に、こうしてみた。</p>

<ul>
<li>適当なところに apt source <package> でリポジトリにあるorig.tarballを持ってくる</li>
<li>適当なところで debcheckout <package> してテンポラリ作業用のgitリポジトリを持ってくる</li>
<li>テンポラリgitリポジトリで
<code>
$ cd /tmp/&lt;package repo&gt;
$ git checkout pristine-tar
$ git rm &lt;該当バージョンのファイル&gt;; git commit -a
$ git checkout master; git tag -d upstream/&lt;version&gt;
$ gbp import-orig &lt;orig.tarball&gt;
</code>
などとしてpristine-tarブランチのファイルを更新して、実際のgitリポジトリに移動して、更新分だけ貰う
<code>
$ cd ~/&lt;package repo&gt;
$ git checkout pristine-tar
$ git pull file:::/tmp/&lt;package repo&gt; pristine-tar
</code></li>
</ul>

<p>回りくどいなーとは思うのだけども。</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
            	
		
			<div class="row">
				
				<div class="col-md-offset-1 col-md-10">
					<h3><a href="https://henrich.github.io/blog/2016/02/13/iso%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%9E%E3%82%A6%E3%83%B3%E3%83%88%E3%81%8C%E6%AE%8B%E3%81%A3%E3%81%A6%E3%81%84%E3%81%A6emergency-mode%E3%81%A7%E8%B5%B7%E5%8B%95/">ISOファイルのマウントが残っていてemergency modeで起動</a></h3>
						<small><span class="label label-primary">
							
								Sat, Feb 13, 2016
							</span>&nbsp;in
							 using tags
							
								
							<a href="/blog/tags/debian">debian</a>
						
								 , 
							<a href="/blog/tags/trouble">trouble</a>
						
					</small>
				</div>
			</div>
			<div class="row">
				<div class="col-md-offset-1 col-md-10">
					<br>
					
						<p>デスクトップを再起動したらemergency modeになってしまった。ううん？なんか変なののアップグレード踏んだかな、でもここ数日そんなクリティカルな情報は見た記憶がない。Sidを使ってるからこういう事態はあり得る…とはいえ、嬉しいものでもない。とりあえずカーネルを差し替えて再起動…1分半ほど待たされた後、同じくemergency modeになった。はて、systemdかX.org周りか。でもアップデートした記憶ないな…と、メッセージ通りrootでログインしてjournalctl -xbでログを見る…あれ？なんかマウントしようとして失敗してる？（ログは消えたので例示できないけど）</p>

<p>前にnautilus経由でイメージマウントしたISOファイルが/etc/fstabにマウントポイントが残っていたのでコメントアウトして、再起動…うまくいった。</p>

<pre><code>#/dev/loop0     /media/henrich/IRM_SHV_X64FRE_JA-JP_DV5 udf     ro,nosuid,nodev,relatime,uid=1000,gid=1000,iocharset=utf8       0       0
#/dev/loop2     /media/henrich/IRM_SHV_X64FRE_JA-JP_DV51        udf     ro,nosuid,nodev,relatime,uid=1000,gid=1000,iocharset=utf8       0       0
#Entry for /dev/loop1 :
#UUID=2015-10-30-20-02-13-00    /media/henrich/J_SSS_X64FRE_JA-JP_DV91  udf     ro,nosuid,nodev,relatime,uid=1000,gid=1000,iocharset=utf8       0       0
</code></pre>

<p>なんなんだこれは。</p>

					
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<hr>
				</div>
			</div>
		
	

        
	</div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="text-center">
                    

<ul class="pagination">
    
    <li>
        <a href="/blog/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li
    >
    <a href="/blog/page/15/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
     
        
        
    
    
    <li
    ><a href="/blog/">1</a></li>
    
    
    
    
    
     
        
        
    
    
    <li
    ><a href="/blog/page/2/">2</a></li>
    
    
    
    
    
     
        
        
    
    
    <li
    ><a href="/blog/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="disabled"><span aria-hidden="true">&hellip;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
     
        
        
    
    
    <li
    ><a href="/blog/page/15/">15</a></li>
    
    
    
    
    
     
        
        
    
    
    <li
    class="active"><a href="/blog/page/16/">16</a></li>
    
    
    
    
    
     
        
        
    
    
    <li
    ><a href="/blog/page/17/">17</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="disabled"><span aria-hidden="true">&hellip;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
     
        
        
    
    
    <li
    ><a href="/blog/page/20/">20</a></li>
    
    
    <li
    >
    <a href="/blog/page/17/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li>
        <a href="/blog/page/20/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <hr>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row col-md-12">
            <footer>
                <div class="pull-left">
                    <p>
                        &copy; 2015-  Hideki Yamane ~ Powered By <a href="http://hugo.spf13.com">Hugo</a> - version: 0.25.1 ~ <a href="https://henrich.github.io/blog//license">License</a>
                    </p>
                </div>

                
                <div class="pull-right">
                    
                    
                    
                        <a href="https://twitter.com/henrich" target="_blank">
                        <i class="fa fa-twitter-square fa-2x"></i></a>
                    
                    
                    
                    
                    
                        <a href="https://henrich.github.io/blog/index.xml" target="_blank">
                        <i class="fa fa-rss-square fa-2x"></i></a>
                    
                </div>
            </footer>
        </div>
    </div>

    
    </body>
</html>

